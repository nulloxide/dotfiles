#!/bin/bash
# Install packages from Brewfile
# This runs whenever the Brewfile changes

set -e

{{ if eq .chezmoi.os "darwin" -}}
echo "Installing Homebrew packages from Brewfile..."

# Change to the source directory where Brewfile is located
cd "{{ .chezmoi.sourceDir }}"

if [ -f "Brewfile" ]; then
    echo "Found Brewfile, installing packages..."
    brew bundle install --no-lock
    echo "✓ Packages installed successfully"
else
    echo "⚠ Warning: Brewfile not found"
    exit 1
fi

# Cleanup old packages
echo "Cleaning up old Homebrew packages..."
brew cleanup
echo "✓ Cleanup complete"

{{ else -}}
echo "⚠ Skipping Homebrew installation (not on macOS)"
{{ end -}}
